from malbench.malware_launcher import MalwareLauncher
from unittest import TestCase
from unittest.mock import patch


class TestMalwareLauncher(TestCase):
    @patch("subprocess.Popen")
    def test_run(self, mock_popen):
        # Simulate running fake malware that completes successfully
        mock_popen.return_value.poll.return_value = 0

        launcher = MalwareLauncher('samples/malware', timeout=0)
        self.assertTrue(launcher.run())

        # Simulate running fake malware that exceeds timeout
        mock_popen.return_value.poll.return_value = None

        launcher = MalwareLauncher('samples/malware', timeout=0)
        self.assertFalse(launcher.run())
